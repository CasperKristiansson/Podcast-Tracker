---
import BaseLayout from '../../../layouts/BaseLayout.astro';
import EpisodesApp from '../../../components/graphql/EpisodesApp';
import { isAuthReady, isApiReady } from '../../../lib/flags';

const { showId } = Astro.params;

if (!showId) {
  throw new Error('showId parameter missing');
}

const authReady = isAuthReady();
const apiReady = isApiReady();
---

<BaseLayout title="Episodes" description="Latest episodes for your subscription.">
  <section class="mx-auto flex max-w-5xl flex-col gap-10 px-6 py-16 md:py-24">
    <div class="space-y-3 text-center md:text-left">
      <a class="text-xs uppercase tracking-[0.35em] text-brand-muted transition hover:text-brand-primary" href="/app">
        &larr; Back to subscriptions
      </a>
      <h1 class="text-3xl font-semibold text-brand-text">Episodes</h1>
      <p class="text-sm text-brand-muted">
        Showing the most recent episodes for this show. Nightly refresh keeps the list up to date.
      </p>
    </div>

    {authReady && apiReady ? (
      <EpisodesApp client:only="react" showId={showId} />
    ) : (
      <div class="rounded-xl border border-brand-primary/30 bg-brand-surface/60 p-8 text-center text-sm text-brand-muted">
        {authReady
          ? 'API is not enabled yet. Episodes are unavailable.'
          : 'Authentication is disabled. Enable auth to view episodes.'}
      </div>
    )}
  </section>
</BaseLayout>
