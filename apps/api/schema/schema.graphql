scalar AWSDateTime

schema {
  query: Query
  mutation: Mutation
  subscription: Subscription
}

interface PaginatedResult {
  nextToken: String
}

type UserSubscription {
  showId: ID!
  title: String!
  publisher: String!
  image: String!
  addedAt: AWSDateTime!
  totalEpisodes: Int!
  subscriptionSyncedAt: AWSDateTime
  ratingStars: Int
  ratingReview: String
  ratingUpdatedAt: AWSDateTime
}

type Episode {
  showId: ID!
  episodeId: ID!
  title: String!
  audioUrl: String!
  publishedAt: AWSDateTime!
  durationSec: Int!
  description: String
  htmlDescription: String
  image: String
  linkUrl: String
  explicit: Boolean
  isExternallyHosted: Boolean
  isPlayable: Boolean
  releaseDatePrecision: String
  languages: [String!]
}

type Progress {
  episodeId: ID!
  positionSec: Int!
  completed: Boolean!
  updatedAt: AWSDateTime!
  showId: ID
}

type Show {
  id: ID!
  title: String!
  publisher: String!
  description: String
  htmlDescription: String
  image: String
  totalEpisodes: Int!
  externalUrl: String
  categories: [String!]!
  explicit: Boolean
  languages: [String!]
  availableMarkets: [String!]
  mediaType: String
  isSubscribed: Boolean
}

type SubscriptionConnection implements PaginatedResult {
  items: [UserSubscription!]!
  nextToken: String
}

type EpisodeConnection implements PaginatedResult {
  items: [Episode!]!
  nextToken: String
}

type ShowDetail {
  show: Show!
  subscription: UserSubscription
  episodes: EpisodeConnection!
  progress: [Progress!]!
}

type Query {
  health: String!
  mySubscriptions(limit: Int, nextToken: String): SubscriptionConnection!
  search(term: String!, limit: Int, offset: Int): [Show!]!
  episode(showId: ID!, episodeId: ID!): Episode
  myProfile: UserProfile!
  showDetail(
    showId: ID!
    episodeLimit: Int
    episodeCursor: String
    progressEpisodeIds: [ID!]
  ): ShowDetail!
}

type ProfileStats {
  totalShows: Int!
  episodesCompleted: Int!
  episodesInProgress: Int!
}

type ProfileShow {
  showId: ID!
  title: String!
  publisher: String!
  image: String!
  addedAt: AWSDateTime!
  totalEpisodes: Int!
  completedEpisodes: Int!
  inProgressEpisodes: Int!
  unlistenedEpisodes: Int!
  subscriptionSyncedAt: AWSDateTime
}

type UserProfile {
  stats: ProfileStats!
  spotlight: [ProfileShow!]!
  shows: [ProfileShow!]!
}

type Mutation {
  subscribe(
    showId: ID!
    title: String!
    publisher: String!
    image: String!
    totalEpisodes: Int
  ): UserSubscription!
  markProgress(
    episodeId: ID!
    positionSec: Int!
    completed: Boolean!
    showId: ID
  ): Progress!
  markNextEpisodeComplete(showId: ID!, limit: Int = 25): Progress!
  markAllEpisodesComplete(showId: ID!): [Progress!]!
  publishProgress(
    episodeId: ID!
    positionSec: Int!
    completed: Boolean!
  ): Progress!
  unsubscribe(showId: ID!): Boolean!
  rateShow(showId: ID!, stars: Int!, review: String): UserSubscription!
}

type Subscription {
  onProgress(episodeId: ID!): Progress!
    @aws_subscribe(mutations: ["publishProgress"])
}
