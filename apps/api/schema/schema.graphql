scalar AWSDateTime

schema {
  query: Query
  mutation: Mutation
  subscription: Subscription
}

interface PaginatedResult {
  nextToken: String
}

type UserSubscription {
  showId: ID!
  title: String!
  publisher: String!
  image: String!
  addedAt: AWSDateTime!
  ratingStars: Int
  ratingReview: String
  ratingUpdatedAt: AWSDateTime
}

type Episode {
  showId: ID!
  episodeId: ID!
  title: String!
  audioUrl: String!
  publishedAt: AWSDateTime!
  durationSec: Int!
  description: String
  image: String
  linkUrl: String
}

type Progress {
  episodeId: ID!
  positionSec: Int!
  completed: Boolean!
  updatedAt: AWSDateTime!
}

type Show {
  id: ID!
  title: String!
  publisher: String!
  description: String
  image: String
  totalEpisodes: Int!
  externalUrl: String
  categories: [String!]!
}

type SubscriptionConnection implements PaginatedResult {
  items: [UserSubscription!]!
  nextToken: String
}

type EpisodeConnection implements PaginatedResult {
  items: [Episode!]!
  nextToken: String
}

type Query {
  health: String!
  mySubscriptions(limit: Int, nextToken: String): SubscriptionConnection!
  episodes(showId: ID!, limit: Int, nextToken: String): EpisodeConnection!
  search(term: String!, limit: Int, offset: Int): [Show!]!
  show(showId: ID!): Show!
  mySubscription(showId: ID!): UserSubscription
  episode(showId: ID!, episodeId: ID!): Episode
  episodeProgress(episodeIds: [ID!]!): [Progress!]!
}

type Mutation {
  subscribe(
    showId: ID!
    title: String!
    publisher: String!
    image: String!
  ): UserSubscription!
  markProgress(
    episodeId: ID!
    positionSec: Int!
    completed: Boolean!
  ): Progress!
  publishProgress(
    episodeId: ID!
    positionSec: Int!
    completed: Boolean!
  ): Progress!
  unsubscribe(showId: ID!): Boolean!
  rateShow(showId: ID!, stars: Int!, review: String): UserSubscription!
}

type Subscription {
  onProgress(episodeId: ID!): Progress!
    @aws_subscribe(mutations: ["publishProgress"])
}
