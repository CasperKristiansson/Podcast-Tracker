#set($userPk = "user#${ctx.identity.sub}")
#set($episodeSk = "ep#${ctx.args.episodeId}")
#set($attributes = {
  "pk": $util.dynamodb.toDynamoDBJson($userPk),
  "sk": $util.dynamodb.toDynamoDBJson($episodeSk),
  "dataType": $util.dynamodb.toDynamoDBJson("progress"),
  "episodeId": $util.dynamodb.toDynamoDBJson($ctx.args.episodeId),
  "positionSec": $util.dynamodb.toDynamoDBJson($ctx.args.positionSec),
  "completed": $util.dynamodb.toDynamoDBJson($ctx.args.completed),
  "updatedAt": $util.dynamodb.toDynamoDBJson($util.time.nowISO8601())
})

#if($ctx.args.containsKey("showId") && !$util.isNull($ctx.args.showId))
  $util.qr($attributes.put("showId", $util.dynamodb.toDynamoDBJson($ctx.args.showId)))
#end

{
  "version": "2018-05-29",
  "operation": "PutItem",
  "key": {
    "pk": $util.dynamodb.toDynamoDBJson($userPk),
    "sk": $util.dynamodb.toDynamoDBJson($episodeSk)
  },
  "attributeValues": $util.toJson($attributes),
  "returnValues": "ALL_NEW"
}
